from langchain_core.prompts import ChatPromptTemplate
from prompts import json_structure, system_message
from langchain_openai import ChatOpenAI
from schemas import InvoiceJson
from dotenv import load_dotenv
from typing import Dict, List
import json
import os

load_dotenv()

def _get_llm(model_name: str) -> ChatOpenAI:
    llm = ChatOpenAI(model=model_name, temperature=0)
    return llm

input_json = [
    {
        "text": "ðŸ’¥ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð½Ð¸Ð¹ Ð²Ð¸Ð±ÑƒÑ… Ñƒ ÐŸÐ°Ð²Ð»Ð¾Ð³Ñ€Ð°Ð´Ñ–.",
        "date": "2024-09-06T07:18:07+00:00",
        "channel": "monitorwarr",
        "link": "https://t.me/monitorwarr/23895"
    },
    {
        "text": "ðŸ’¥ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð½Ñ– Ð²Ð¸Ð±ÑƒÑ…Ð¸ Ñƒ ÐŸÐ°Ð²Ð»Ð¾Ð³Ñ€Ð°Ð´Ñ–.",
        "date": "2024-09-06T07:01:12+00:00",
        "channel": "monitorwarr",
        "link": "https://t.me/monitorwarr/23894"
    },
    {
        "text": "Ð”Ð°Ð»ÐµÐºÐ¾Ð±Ñ–Ð¹Ð½Ñ–ÑÑ‚ÑŒ. Ð¯ Ñ€Ð°Ð´Ð¸Ð¹, Ñ‰Ð¾ Ñ‚ÑƒÑ‚, Ð½Ð° Â«Ð Ð°Ð¼ÑˆÑ‚Ð°Ð¹Ð½Ñ–Â», Ð¿Ñ€ÐµÐ´ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ñ– Ð¡Ð¨Ð, Ð’ÐµÐ»Ð¸ÐºÐ° Ð‘Ñ€Ð¸Ñ‚Ð°Ð½Ñ–Ñ, Ð¤Ñ€Ð°Ð½Ñ†Ñ–Ñ, Ð†Ñ‚Ð°Ð»Ñ–Ñ. Ð¥Ð¾Ñ‡Ñƒ ÑÐºÐ°Ð·Ð°Ñ‚Ð¸ Ñ†Ðµ Ð²Ñ–Ð´ÐºÑ€Ð¸Ñ‚Ð¾, Ñ‰Ð¾Ð± Ð½Ðµ Ð±ÑƒÐ»Ð¾ Ð¶Ð¾Ð´Ð½Ð¸Ñ… ÑÐ¿ÐµÐºÑƒÐ»ÑÑ†Ñ–Ð¹. Ð—Ð°Ð²Ð´ÑÐºÐ¸ Ð½Ð°ÑˆÑ–Ð¹ ÑÐ¿Ñ–Ð»ÑŒÐ½Ñ–Ð¹ Ð²Ñ–Ð´Ð²Ð°Ð·Ñ– Ð¼Ð¸ Ð·Ð´Ñ–Ð¹ÑÐ½Ð¸Ð»Ð¸ Ð´ÑƒÐ¶Ðµ Ð²Ð°Ð¶Ð»Ð¸Ð²Ñ– Ð¾Ð¿ÐµÑ€Ð°Ñ†Ñ–Ñ—, Ð·Ð¾ÐºÑ€ÐµÐ¼Ð° Ð² ÐšÑ€Ð¸Ð¼Ñƒ. Ð¦Ñ– Ð¾Ð¿ÐµÑ€Ð°Ñ†Ñ–Ñ— Ð´Ð°Ð»Ð¸ Ð½Ð°Ð¼ Ð·Ð¼Ð¾Ð³Ñƒ Ð¿Ð¾Ð²ÐµÑ€Ð½ÑƒÑ‚Ð¸ Ð±ÐµÐ·Ð¿ÐµÐºÑƒ Ð² Ð§Ð¾Ñ€Ð½Ðµ Ð¼Ð¾Ñ€Ðµ Ð¹ Ð²Ñ–Ð´Ð½Ð¾Ð²Ð¸Ñ‚Ð¸ Ð½Ð°Ñˆ ÐµÐºÑÐ¿Ð¾Ñ€Ñ‚ Ð¿Ñ€Ð¾Ð´Ð¾Ð²Ð¾Ð»ÑŒÑÑ‚Ð²Ð°. \n\nÐ—Ð°Ñ€Ð°Ð· Ð¼Ð¸ Ñ‡ÑƒÑ”Ð¼Ð¾, Ñ‰Ð¾ Ð²Ð°ÑˆÐ° Ð¿Ð¾Ð»Ñ–Ñ‚Ð¸ÐºÐ° Ñ‰Ð¾Ð´Ð¾ Ð´Ð°Ð»ÐµÐºÐ¾Ð±Ñ–Ð¹Ð½Ð¾ÑÑ‚Ñ– Ð½Ðµ Ð·Ð¼Ñ–Ð½Ð¸Ð»Ð°ÑÑ, Ð°Ð»Ðµ Ð¼Ð¸ Ð±Ð°Ñ‡Ð¸Ð¼Ð¾ Ð·Ð¼Ñ–Ð½Ð¸ Ñ‰Ð¾Ð´Ð¾ ATACMS, Storm Shadow Ñ– SCALP â€“ Ð´ÐµÑ„Ñ–Ñ†Ð¸Ñ‚ Ñ€Ð°ÐºÐµÑ‚ Ñ– ÑÐ¿Ñ–Ð²Ð¿Ñ€Ð°Ñ†Ñ–. Ð† Ñ†Ðµ ÑÑ‚Ð¾ÑÑƒÑ”Ñ‚ÑŒÑÑ Ð½Ð°Ð²Ñ–Ñ‚ÑŒ Ð½Ð°ÑˆÐ¾Ñ— Ñ‚ÐµÑ€Ð¸Ñ‚Ð¾Ñ€Ñ–Ñ—, Ð¾ÐºÑƒÐ¿Ð¾Ð²Ð°Ð½Ð¾Ñ— Ð Ð¾ÑÑ–Ñ”ÑŽ, Ð²ÐºÐ»ÑŽÑ‡Ð½Ð¾ Ð· ÐšÑ€Ð¸Ð¼Ð¾Ð¼. ÐœÐ¸ Ð²Ð²Ð°Ð¶Ð°Ñ”Ð¼Ð¾ Ñ‚Ð°ÐºÑ– ÐºÑ€Ð¾ÐºÐ¸ Ð¿Ð¾Ð¼Ð¸Ð»ÐºÐ¾Ð²Ð¸Ð¼Ð¸. ÐÐ°Ð¼ Ð½ÐµÐ¾Ð±Ñ…Ñ–Ð´Ð½Ð° Ñ†Ñ Ð´Ð°Ð»ÐµÐºÐ¾Ð±Ñ–Ð¹Ð½Ñ–ÑÑ‚ÑŒ Ð½Ðµ Ð»Ð¸ÑˆÐµ Ð½Ð° Ð¾ÐºÑƒÐ¿Ð¾Ð²Ð°Ð½Ñ–Ð¹ Ñ‚ÐµÑ€Ð¸Ñ‚Ð¾Ñ€Ñ–Ñ— Ð£ÐºÑ€Ð°Ñ—Ð½Ð¸, Ð° Ð¹ Ð½Ð° Ñ‚ÐµÑ€Ð¸Ñ‚Ð¾Ñ€Ñ–Ñ— Ð Ð¾ÑÑ–Ñ—, Ñ‰Ð¾Ð± Ñƒ Ð Ð¾ÑÑ–Ñ— Ð±ÑƒÐ² ÑÑ‚Ð¸Ð¼ÑƒÐ» Ð¿Ñ€Ð°Ð³Ð½ÑƒÑ‚Ð¸ Ð´Ð¾ Ð¼Ð¸Ñ€Ñƒ.",
        "date": "2024-09-06T09:47:15+00:00",
        "channel": "UkraineNow",
        "link": "https://t.me/UkraineNow/58471"
    },
    {
        "text": "**Ð’ Ð”Ð¡ÐÐ¡ Ð¿Ð¾ÐºÐ°Ð·Ð°Ð»Ð¸ Ð½Ð°ÑÐ»Ñ–Ð´ÐºÐ¸ Ð²Ð¾Ñ€Ð¾Ð¶Ð¾Ð³Ð¾ ÑƒÐ´Ð°Ñ€Ñƒ Ð¿Ð¾ ÐŸÐ°Ð²Ð»Ð¾Ð³Ñ€Ð°Ð´Ñ–**\n\nÐ—Ð° Ð´Ð°Ð½Ð¸Ð¼Ð¸ Ð”Ð½Ñ–Ð¿Ñ€Ð¾Ð¿ÐµÑ‚Ñ€Ð¾Ð²ÑÑŒÐºÐ¾Ñ— ÐžÐ’Ð Ð¿Ð¾Ð¼ÐµÑ€Ð»Ð° 1 Ð»ÑŽÐ´Ð¸Ð½Ð°. \n\nÐ’Ð¶Ðµ 40 Ð¿Ð¾ÑÑ‚Ñ€Ð°Ð¶Ð´Ð°Ð»Ð¸Ñ…, - Ð”Ð¡ÐÐ¡.\n\n[âœ…Ð¿Ñ–Ð´Ð¿Ð¸ÑÑƒÐ¹ÑÑ Ð½Ð° Ukraine NOW](https://t.me/UkraineNow)",
        "date": "2024-09-06T09:41:24+00:00",
        "channel": "UkraineNow",
        "link": "https://t.me/UkraineNow/58466"
    },
    {
        "text": "**Ð£ÐºÑ€Ð°Ñ—Ð½Ð° Ð¿Ñ–Ð´ Ð¾Ð±ÑÑ‚Ñ€Ñ–Ð»Ð°Ð¼Ð¸ - ÑÐ¸Ñ‚ÑƒÐ°Ñ†Ñ–Ñ Ð² Ñ€ÐµÐ³Ñ–Ð¾Ð½Ð°Ñ… Ð·Ð° Ð´Ð¾Ð±Ñƒ**\n\n**ðŸ“Ð”Ð½Ñ–Ð¿Ñ€Ð¾Ð²Ñ‰Ð¸Ð½Ð°**\nÐ£ ÐŸÐ°Ð²Ð»Ð¾Ð³Ñ€Ð°Ð´Ñ– Ð²Ð½Ð°ÑÐ»Ñ–Ð´Ð¾Ðº Ñ€Ð°Ð½ÐºÐ¾Ð²Ð¾Ð³Ð¾ Ð²Ð¾Ñ€Ð¾Ð¶Ð¾Ð³Ð¾ Ð¾Ð±ÑÑ‚Ñ€Ñ–Ð»Ñƒ Ð²Ð¶Ðµ 30 Ð¿Ð¾Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ…. Ð¢Ñ€Ð¾Ñ” Ð· Ð½Ð¸Ñ… â€“ Ð´Ñ–Ñ‚Ð¸. ÐžÐºÑ€Ñ–Ð¼ 9-Ñ€Ñ–Ñ‡Ð½Ð¾Ñ— Ð´Ñ–Ð²Ñ‡Ð¸Ð½ÐºÐ¸, Ñ‡ÐµÑ€ÐµÐ· Ñ€Ð°ÐºÐµÑ‚Ð½Ñƒ Ð°Ñ‚Ð°ÐºÑƒ Ð¿Ð¾Ñ‚ÐµÑ€Ð¿Ñ–Ð»Ð¸ Ñ…Ð»Ð¾Ð¿Ñ‡Ð¸ÐºÐ¸ 11 Ñ‚Ð° 4 Ñ€Ð¾ÐºÑ–Ð². Ð¡ÐµÑ€ÐµÐ´ Ð»ÑŽÐ´ÐµÐ¹, ÑÐºÑ– Ñƒ Ð»Ñ–ÐºÐ°Ñ€Ð½Ñ–, Ð´Ð²Ð¾Ñ” Ð²Ð°Ð¶ÐºÐ¸Ñ…. Ð£ ÐÑ–ÐºÐ¾Ð¿Ð¾Ð»ÑŒÑ‰Ð¸Ð½Ñ– 2 Ð¿Ð¾Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ…. Ð—Ð½ÐµÑÑ‚Ñ€ÑƒÐ¼Ð»ÐµÐ½Ñ– 7 Ð½Ð°ÑÐµÐ»ÐµÐ½Ð¸Ñ… Ð¿ÑƒÐ½ÐºÑ‚Ñ–Ð² Ñ€Ð°Ð¹Ð¾Ð½Ñƒ. ÐŸÐ¾Ð½Ñ–Ð²ÐµÑ‡ÐµÐ½Ñ– Ð¾ÑÐµÐ»Ñ–, Ð›Ð•ÐŸ, Ð³Ð°Ð·Ð¾Ð¿Ñ€Ð¾Ð²Ð¾Ð´Ð¸. ÐÐ° ÐšÑ€Ð¸Ð²Ð¾Ñ€Ñ–Ð¶Ð¶Ñ Ð²Ð¾Ñ€Ð¾Ð³ ÑÐ¿Ñ€ÑÐ¼ÑƒÐ²Ð°Ð² Ð´Ñ€Ð¾Ð½-ÐºÐ°Ð¼Ñ–ÐºÐ°Ð´Ð·Ðµ. Ð§ÐµÑ€ÐµÐ· Ñ†Ðµ Ð² Ð¾Ð´Ð½Ð¾Ð¼Ñƒ Ð· Ð½Ð°ÑÐµÐ»ÐµÐ½Ð¸Ñ… Ð¿ÑƒÐ½ÐºÑ‚Ñ–Ð² Ð¿Ð¾ÑˆÐºÐ¾Ð´Ð¶ÐµÐ½Ð¸Ð¹ Ð¿Ñ€Ð¸Ð²Ð°Ñ‚Ð½Ð¸Ð¹ Ð±ÑƒÐ´Ð¸Ð½Ð¾Ðº. Ð£ Ð¡Ð¸Ð½ÐµÐ»ÑŒÐ½Ð¸ÐºÑ–Ð²ÑÑŒÐºÐ¾Ð¼Ñƒ Ñ€Ð°Ð¹Ð¾Ð½Ñ– Ð·Ð½Ð¸Ñ‰ÐµÐ½Ð¾ Ð³Ð¾ÑÐ¿ÑÐ¿Ð¾Ñ€ÑƒÐ´Ñƒ Ñ‚Ð° Ð¿Ð¾Ñ‚Ñ€Ð¾Ñ‰ÐµÐ½Ð¾ Ð´Ð¾ 10 Ð¿Ñ€Ð¸Ð²Ð°Ñ‚Ð½Ð¸Ñ… Ð±ÑƒÐ´Ð¸Ð½ÐºÑ–Ð².\n\n**ðŸ“Ð›ÑŒÐ²Ñ–Ð²Ñ‰Ð¸Ð½Ð°**\nÐ²Ð¾Ñ€Ð¾Ð³ Ð°Ñ‚Ð°ÐºÑƒÐ²Ð°Ð² Ð¾Ð±Ð»Ð°ÑÑ‚ÑŒ Ð±Ð¾Ð¹Ð¾Ð²Ð¸Ð¼Ð¸ Ð±ÐµÐ·Ð¿Ñ–Ð»Ð¾Ñ‚Ð½Ð¸ÐºÐ°Ð¼Ð¸. Ð§ÐµÑ€ÐµÐ· Ð¿Ð°Ð´Ñ–Ð½Ð½Ñ ÑƒÐ»Ð°Ð¼ÐºÑ–Ð² Ð·Ð°Ð³Ð¾Ñ€Ñ–Ð»Ð¸ÑÑ 4 Ð²Ð°Ð½Ñ‚Ð°Ð¶Ñ–Ð²ÐºÐ¸ Ñƒ Ð¿Ñ€Ð¾Ð¼Ð¸ÑÐ»Ð¾Ð²Ñ–Ð¹ Ð·Ð¾Ð½Ñ– (Ð¼Ð°ÑˆÐ¸Ð½Ð¸ Ñ€ÐµÐ¼Ð¾Ð½Ñ‚Ñƒ Ð½Ðµ Ð¿Ñ–Ð´Ð»ÑÐ³Ð°ÑŽÑ‚ÑŒ). ÐÐ°Ð´ Ð»Ñ–ÐºÐ²Ñ–Ð´Ð°Ñ†Ñ–Ñ”ÑŽ Ð·Ð°Ð¹Ð¼Ð°Ð½Ð½Ñ Ð¿Ñ€Ð°Ñ†ÑŽÐ²Ð°Ð»Ð¸ 32 Ð¿Ð¾Ð¶ÐµÐ¶Ð½Ð¸ÐºÐ¸, Ð·Ð°Ð»ÑƒÑ‡Ð°Ð»Ð¸ 6 Ð¾Ð´Ð¸Ð½Ð¸Ñ†ÑŒ ÑÐ¿ÐµÑ†Ñ‚ÐµÑ…Ð½Ñ–ÐºÐ¸.  ÐŸÐ¾Ð½Ñ–Ð²ÐµÑ‡ÐµÐ½Ñ– ÑÐºÐ»Ð°Ð´ÑÑŒÐºÑ– Ð¿Ñ€Ð¸Ð¼Ñ–Ñ‰ÐµÐ½Ð½Ñ.\n\n**ðŸ“Ð¥ÐµÑ€ÑÐ¾Ð½Ñ‰Ð¸Ð½Ð°**\nÐŸÑ–ÑÐ»Ñ 10.00 Ð°Ñ€Ð¼Ñ–Ñ Ñ€Ñ„ Ð¾Ð±ÑÑ‚Ñ€Ñ–Ð»ÑÐ»Ð° ÐšÐ¾Ð¼Ð¸ÑˆÐ°Ð½Ð¸. Ð”Ð¾ Ð»Ñ–ÐºÐ°Ñ€Ð½Ñ– ÑƒÑˆÐ¿Ð¸Ñ‚Ð°Ð»Ð¸Ð»Ð¸ 72-Ñ€Ñ–Ñ‡Ð½Ñƒ Ð¶Ñ–Ð½ÐºÑƒ. Ð’ ÐÐ½Ñ‚Ð¾Ð½Ñ–Ð²Ñ†Ñ– Ñ‡ÐµÑ€ÐµÐ· Ñ€Ð¾ÑÑ–Ð¹ÑÑŒÐºÐ¸Ð¹ Ñ‚ÐµÑ€Ð¾Ñ€ ÑƒÑˆÐ¿Ð¸Ñ‚Ð°Ð»ÐµÐ½Ð¾ 70-Ñ€Ñ–Ñ‡Ð½Ð¾Ð³Ð¾ Ñ‡Ð¾Ð»Ð¾Ð²Ñ–ÐºÐ°. Ð£ Ð»Ñ–ÐºÐ°Ñ€Ð½Ñ– Ð¿Ð¾Ð¼ÐµÑ€ 65-Ñ€Ñ–Ñ‡Ð½Ð¸Ð¹ Ñ‡Ð¾Ð»Ð¾Ð²Ñ–Ðº, ÑÐºÐ¸Ð¹ Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ð² Ð¿Ð¾Ñ€Ð°Ð½ÐµÐ½Ð½Ñ Ñ‰Ðµ 21 ÑÐµÑ€Ð¿Ð½Ñ Ñƒ ÐšÑ–Ð½Ð´Ñ–Ð¹Ñ†Ñ–. Ð—Ñ€Ð°Ð½ÐºÑƒ Ð²Ð¾Ñ€Ð¾Ð³ Ð±Ð¸Ð² Ð· Ð°Ð²Ñ–Ð°Ñ†Ñ–Ñ— Ð¿Ð¾ Ð¥ÐµÑ€ÑÐ¾Ð½Ñ‰Ð¸Ð½Ñ–: 2 ÐšÐÐ‘Ð¸ Ð²Ð»ÑƒÑ‡Ð¸Ð»Ð¸ Ð² Ð´Ð¸Ñ‚ÑÐ°Ð´Ð¾Ðº, Ð·Ñ€ÑƒÐ¹Ð½ÑƒÐ²Ð°Ð²ÑˆÐ¸ Ð¹Ð¾Ð³Ð¾. Ð¢Ð°ÐºÐ¾Ð¶ Ð¿Ð¾Ð½Ñ–Ð²ÐµÑ‡ÐµÐ½Ð¾ ÐŸÑƒÐ½ÐºÑ‚ ÐÐµÐ·Ð»Ð°Ð¼Ð½Ð¾ÑÑ‚Ñ–, Ð°Ð²Ñ‚Ð¾Ð±ÑƒÑ Ñ‚Ð° Ð±ÑƒÐ´Ð¸Ð½ÐºÐ¸. Ð—Ð° Ð´Ð¾Ð±Ñƒ Ñ€Ð¾ÑÑ–ÑÐ½Ð¸ Ð¿Ð¾Ñ€Ð°Ð½Ð¸Ð»Ð¸ Ñ‰Ðµ 4 Ð»ÑŽÐ´ÐµÐ¹, Ð¿Ð¾Ñ†Ñ–Ð»Ð¸Ð²ÑˆÐ¸ Ð² Ð¾ÑÐ²Ñ–Ñ‚Ð½Ñ–Ð¹ Ñ‚Ð° Ð¼ÐµÐ´Ð¸Ñ‡Ð½Ñ– Ð·Ð°ÐºÐ»Ð°Ð´Ð¸, Ð°Ð´Ð¼Ñ–Ð½Ð±ÑƒÐ´Ñ–Ð²Ð»ÑŽ, Ð¢Ð Ð¦, 2 Ð±Ð°Ð³Ð°Ñ‚Ð¾Ð¿Ð¾Ð²ÐµÑ€Ñ…Ñ–Ð²ÐºÐ¸, 8 Ð¿Ñ€Ð¸Ð²Ð°Ñ‚Ð½Ð¸Ñ… Ð±ÑƒÐ´Ð¸Ð½ÐºÑ–Ð², ÑÐºÐ»Ð°Ð´ÑÑŒÐºÐµ Ð¿Ñ€Ð¸Ð¼Ñ–Ñ‰ÐµÐ½Ð½Ñ Ñ‚Ð° Ð°Ð²Ñ‚Ñ–Ð²ÐºÐ¸. \n\n**ðŸ“Ð¡ÑƒÐ¼Ñ‰Ð¸Ð½Ð°**\nÑ€Ð¾ÑÑ–Ð¹ÑÑŒÐºÐ° Ð°Ñ€Ð¼Ñ–Ñ Ð½Ð°Ð½ÐµÑÐ»Ð° 160 ÑƒÐ´Ð°Ñ€Ñ–Ð² Ð¿Ð¾ 46 Ð½Ð°ÑÐµÐ»ÐµÐ½Ð¸Ñ… Ð¿ÑƒÐ½ÐºÑ‚Ð°Ñ…: Ð¿Ð¾ÑˆÐºÐ¾Ð´Ð¶ÐµÐ½Ð¾ 3 Ð±Ð°Ð³Ð°Ñ‚Ð¾Ð¿Ð¾Ð²ÐµÑ€Ñ…Ñ–Ð²ÐºÐ¸, 25 Ð±ÑƒÐ´Ð¸Ð½ÐºÑ–Ð², Ð»Ñ–ÐºÐ°Ñ€Ð½ÑŽ, Ð»Ñ–Ñ†ÐµÐ¹, Ð¿Ñ–Ð´Ð¿Ñ€Ð¸Ñ”Ð¼ÑÑ‚Ð²Ð°, Ð³Ð¾ÑÐ¿ÑÐ¿Ð¾Ñ€ÑƒÐ´Ñƒ, 2 Ð³Ð°Ñ€Ð°Ð¶Ñ–, 3 Ð°Ð²Ñ‚Ñ–Ð²ÐºÐ¸, 2 Ð²Ð°Ð½Ñ‚Ð°Ð¶Ñ–Ð²ÐºÐ¸ Ñ‚Ð° 2 Ð¿Ñ€Ð¸Ñ‡ÐµÐ¿Ð¸. \n\n**ðŸ“Ð”Ð¾Ð½ÐµÑ‡Ñ‡Ð¸Ð½Ð°**\nÑ€Ð¾ÑÑ–ÑÐ½Ð¸ Ð²Ð±Ð¸Ð»Ð¸ 2 Ð»ÑŽÐ´ÐµÐ¹. Ð©Ðµ 12 Ñ†Ð¸Ð²Ñ–Ð»ÑŒÐ½Ð¸Ñ… Ð¿Ð¾Ñ€Ð°Ð½Ð¸Ð»Ð¸. ÐŸÐ¾Ð½Ñ–Ð²ÐµÑ‡Ð¸Ð»Ð¸ Ð¿Ð¾Ð½Ð°Ð´ 120 Ð¿Ñ€Ð¸Ð²Ð°Ñ‚Ð½Ð¸Ñ… Ð±ÑƒÐ´Ð¸Ð½ÐºÑ–Ð², 15 Ð±Ð°Ð³Ð°Ñ‚Ð¾Ð¿Ð¾Ð²ÐµÑ€Ñ…Ñ–Ð²Ð¾Ðº, 2 Ð¾Ð±Ê¼Ñ”ÐºÑ‚Ð¸ Ñ–Ð½Ñ„Ñ€Ð°ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¸, 4 Ð›Ð•ÐŸ Ñ‚Ð° Ð¿Ñ–Ð´Ð¿Ñ€Ð¸Ñ”Ð¼ÑÑ‚Ð²Ð°.\n\n**ðŸ“ÐšÐ¸Ñ—Ð²Ñ‰Ð¸Ð½Ð°**\nÐ’Ð½Ð°ÑÐ»Ñ–Ð´Ð¾Ðº Ð¿Ð°Ð´Ñ–Ð½Ð½Ñ ÑƒÐ»Ð°Ð¼ÐºÑ–Ð² Ñ€Ð°ÑˆÐ¸ÑÑ‚ÑÑŒÐºÐ¸Ñ… Ð´Ñ€Ð¾Ð½Ñ–Ð² Ð² 2 Ñ€Ð°Ð¹Ð¾Ð½Ð°Ñ… Ð½Ð° Ð²Ñ–Ð´ÐºÑ€Ð¸Ñ‚Ð¸Ñ… Ð´Ñ–Ð»ÑÐ½ÐºÐ°Ñ… Ð¼Ñ–ÑÑ†ÐµÐ²Ð¾ÑÑ‚Ñ– ÑÑ‚Ð°Ð»Ð¸ÑÑ 2 Ð¿Ð¾Ð¶ÐµÐ¶Ñ– Ñ‚Ñ€Ð°Ð²'ÑÐ½Ð¾Ð³Ð¾ Ð½Ð°ÑÑ‚Ð¸Ð»Ñƒ Ñ‚Ð° Ð¿Ð¾Ð¶ÐµÐ¶Ð° Ð»Ñ–ÑÐ¾Ð²Ð¾Ñ— Ð¿Ñ–Ð´ÑÑ‚Ð¸Ð»ÐºÐ¸.\n\n**ðŸ“Ð¥Ð°Ñ€ÐºÑ–Ð²Ñ‰Ð¸Ð½Ð°**\nÐ¡ÑŒÐ¾Ð³Ð¾Ð´Ð½Ñ– Ð±Ð»Ð¸Ð·ÑŒÐºÐ¾ 8:50 Ð²Ð¾Ñ€Ð¾Ð³ Ð·Ð´Ñ–Ð¹ÑÐ½Ð¸Ð² Ð¾Ð±ÑÑ‚Ñ€Ñ–Ð» ÑÐµÐ»Ð° Ð’Ñ–Ð»ÑŒÑˆÐ°Ð½Ð¸: Ð¿Ð¾Ñ€Ð°Ð½ÐµÐ½Ð¾ Ð¿Ñ€Ð°Ñ†Ñ–Ð²Ð½Ð¸ÐºÐ° Ð¼Ñ–ÑÑ†ÐµÐ²Ð¾Ð³Ð¾ Ð¿Ñ–Ð´Ð¿Ñ€Ð¸Ñ”Ð¼ÑÑ‚Ð²Ð°, Ð¿Ð¾ÑˆÐºÐ¾Ð´Ð¶ÐµÐ½Ð¾ Ð²Ð°Ð½Ñ‚Ð°Ð¶Ñ–Ð²ÐºÑƒ, Ð·Ð°Ð¹Ð½ÑÐ»Ð°ÑÑ Ð¿Ð¾Ð¶ÐµÐ¶Ð° Ð² ÐµÐºÐ¾ÑÐ¸ÑÑ‚ÐµÐ¼Ñ– Ð½Ð° Ð²Ñ–Ð´ÐºÑ€Ð¸Ñ‚Ñ–Ð¹ Ñ‚ÐµÑ€Ð¸Ñ‚Ð¾Ñ€Ñ–Ñ—. Ð—Ð° Ð´Ð¾Ð±Ñƒ Ð² Ð¾Ð±Ð»Ð°ÑÑ‚Ñ– Ñ‡ÐµÑ€ÐµÐ· Ð·Ñ Ñ€Ñ„ Ð¿Ð¾ÑÑ‚Ñ€Ð°Ð¶Ð´Ð°Ð»Ð¸ Ñ‰Ðµ 2 Ð¾ÑÐ¾Ð±Ð¸. Ð“Ð¾Ñ€Ñ–Ð»Ð¸ Ñ‚Ñ€Ð°Ð²Ð°, Ð»Ñ–ÑÐ¾Ð²Ñ– Ð¿Ñ–Ð´ÑÑ‚Ð¸Ð»ÐºÐ¸, 5 Ð³Ð¾ÑÐ¿ÑÐ¿Ð¾Ñ€ÑƒÐ´, 2 Ð±ÑƒÐ´Ð¸Ð½ÐºÐ¸, 4 Ð¿Ñ€Ð¸Ð²Ð°Ñ‚Ð½Ð¸Ñ… Ð´Ð¾Ð¼Ð¾Ð²Ð¾Ð»Ð¾Ð´Ñ–Ð½ÑŒ. ÐŸÐ¾ÑˆÐºÐ¾Ð´Ð¶ÐµÐ½Ñ– Ð»Ñ–Ð½Ñ–Ñ— ÐµÐ»ÐµÐºÑ‚Ñ€Ð¾Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‡.\n\n**ðŸ“Ð—Ð°Ð¿Ð¾Ñ€Ñ–Ð¶Ð¶Ñ**\nÐ’Ð¿Ñ€Ð¾Ð´Ð¾Ð²Ð¶ Ð´Ð¾Ð±Ð¸ Ð¾ÐºÑƒÐ¿Ð°Ð½Ñ‚Ð¸ 330 Ñ€Ð°Ð·Ñ–Ð² Ð±Ð¸Ð»Ð¸ Ð¿Ð¾ 11 Ð½Ð°ÑÐµÐ»ÐµÐ½Ð¸Ñ… Ð¿ÑƒÐ½ÐºÑ‚Ð°Ñ…. ÐÐ°Ð´Ñ–Ð¹ÑˆÐ»Ð¾ 21 Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ Ð¿Ñ€Ð¾ Ñ€ÑƒÐ¹Ð½ÑƒÐ²Ð°Ð½Ð½Ñ Ð¶Ð¸Ñ‚Ð»Ð¾Ð²Ð¸Ñ… Ð±ÑƒÐ´Ð¸Ð½ÐºÑ–Ð² Ñ‚Ð° Ð¾Ð±'Ñ”ÐºÑ‚Ñ–Ð² Ñ–Ð½Ñ„Ñ€Ð°ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¸. \n\n**ðŸ“ÐœÐ¸ÐºÐ¾Ð»Ð°Ñ—Ð²Ñ‰Ð¸Ð½Ð°**\nÐÐ°Ð´ Ð¾Ð±Ð»Ð°ÑÑ‚ÑŽ Ð·Ð½Ð¸Ñ‰Ð¸Ð»Ð¸ 7 Ð‘ÐŸÐ›Ð Ð²Ð¾Ñ€Ð¾Ð³Ð°. Ð’Ð½Ð°ÑÐ»Ñ–Ð´Ð¾Ðº Ð¿Ð°Ð´Ñ–Ð½Ð½Ñ ÑƒÐ»Ð°Ð¼ÐºÑ–Ð² Ñƒ Ð‘Ð°ÑˆÑ‚Ð°Ð½ÑÑŒÐºÐ¾Ð¼Ñƒ Ñ€Ð°Ð¹Ð¾Ð½Ñ– Ð½Ð° Ð²Ñ–Ð´ÐºÑ€Ð¸Ñ‚Ñ–Ð¹ Ñ‚ÐµÑ€Ð¸Ñ‚Ð¾Ñ€Ñ–Ñ— Ð²Ñ–Ð´Ð±ÑƒÐ»Ð¾ÑÑ Ð·Ð°Ð¹Ð¼Ð°Ð½Ð½Ñ ÑÑƒÑ…Ð¾Ñ— Ñ‚Ñ€Ð°Ð²Ð¸, ÑÐºÐµ Ð±ÑƒÐ»Ð¾ Ð¾Ð¿ÐµÑ€Ð°Ñ‚Ð¸Ð²Ð½Ð¾ Ð»Ñ–ÐºÐ²Ñ–Ð´Ð¾Ð²Ð°Ð½Ð¾. Ð’Ñ‡Ð¾Ñ€Ð° Ð¾ÐºÑƒÐ¿Ð°Ð½Ñ‚Ð¸ Ð¿Ð¾ÑˆÐºÐ¾Ð´Ð¸Ð»Ð¸ Ð±ÑƒÐ´Ð¸Ð½Ð¾Ðº Ñƒ Ñ. Ð”Ð¼Ð¸Ñ‚Ñ€Ñ–Ð²ÐºÐ°, Ð¾Ð±ÑÑ‚Ñ€Ñ–Ð»ÑÐ²ÑˆÐ¸ ÐšÑƒÑ†ÑƒÑ€ÑƒÐ±ÑÑŒÐºÑƒ Ð³Ñ€Ð¾Ð¼Ð°Ð´Ñƒ Ð· Ð°Ñ€Ñ‚Ð¸Ð»ÐµÑ€Ñ–Ñ—.\n\n[âœ…Ð¿Ñ–Ð´Ð¿Ð¸ÑÑƒÐ¹ÑÑ Ð½Ð° Ukraine NOW](https://t.me/UkraineNow)",
        "date": "2024-09-06T09:36:20+00:00",
        "channel": "UkraineNow",
        "link": "https://t.me/UkraineNow/58465"
    }
]


def collect_info(input_json: List[dict]) -> List[dict]:
    llm = _get_llm("gpt-4o-mini")    
    for entry in input_json:
        text = entry["text"]

        try:

            structured_llm = llm.with_structured_output(InvoiceJson)
            system_prompt = system_message.format(json_structure=json_structure)
            prompt = ChatPromptTemplate.from_messages(
                [("system", system_prompt), ("human", "{input}")]
            )
            few_shot_structured_llm = prompt | structured_llm
            
            input_prompt = f"raw_text: {text}"
            data = few_shot_structured_llm.invoke({"input": input_prompt})
            result = [dict(region) for region in data.info]
            entry['emergency_info'] = result
        except Exception as e:
            print(e)
    
        
    return input_json
    

jsonr = collect_info(input_json=input_json)
for i in jsonr:
    print("_"*20)
    print(i)
    print("_"*20)
